all: drmaa examples
examples: example-large
ifeq (@SQLITE3_EXISTS@,1)
drmaa: drmaa2.so setup_persistency wrapper
else
drmaa: drmaa2.so setup_persistency wrapper sqlite3.o
endif
tests: force_look
	cd tests; $(MAKE) $(MFLAGS) 

drmaa2.so: drmaa2.o drmaa2-specific.o drmaa2-persistence.o drmaa2-list.o drmaa2-dict.o
	@CC@ -o $@ -shared @LIBS@ $^

setup_persistency: setup_db.o drmaa2.so 
	@CC@ -o $@ @LIBS@ $^

wrapper: wrapper.o drmaa2.so
	@CC@ -o $@ @LIBS@ $^

drmaa2-persistence.o: drmaa2-persistence.c drmaa2-list.c 
	@CC@ @CFLAGS@ -c $^

drmaa2-specific.o: drmaa2-specific.c
	@CC@ @CFLAGS@ -c $^

example-large: example-large.o drmaa2.so
	@CC@ -o $@ @LIBS@ $^

example-large.o: examples/large.c
	@CC@ -o $@ -c $^

force_look:
	true

%.o: %.c
	@CC@ -Wall -g -c $<

sqlite3.o: lib/sqlite3.c lib/sqlite3.h
	@CC@ @CFLAGS@ -c $<

clean:
	rm -f setup wrapper
	rm -f *.o
	rm -f *.so
	rm -f tests/*.o tests/test
	rm -f app example-large test_app
